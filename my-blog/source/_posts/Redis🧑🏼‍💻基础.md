---
title: RedisğŸ§‘ğŸ¼â€ğŸ’»åŸºç¡€
date: 2022/5/29 01:22:14
updated: 2023/3/23 23:01:08
categories:
- Middleware
tags:
- Redis
---

# ç®€ä»‹

## ä»€ä¹ˆæ˜¯Redis

Redisæ˜¯å†…å­˜é«˜é€Ÿç¼“å­˜æ•°æ®åº“ã€‚å…¨ç§°ä¸ºï¼šRemote Dictionary Serverï¼ˆè¿œç¨‹æ•°æ®æœåŠ¡ï¼‰ã€‚

Redisç”±cè¯­è¨€ç¼–å†™ï¼Œkey-valueå­˜å‚¨ç³»ç»Ÿï¼Œæ”¯æŒstringã€listã€setã€zsetã€hashç‰©ç§æ•°æ®ç±»å‹ã€‚

Rediså¯ç”¨äºç¼“å­˜ã€äº‹ä»¶å‘å¸ƒæˆ–è®¢é˜…ã€é«˜é€Ÿé˜Ÿåˆ—ç­‰åœºæ™¯ã€‚åŸºäºå†…å­˜ï¼Œå¯æŒä¹…åŒ–ã€‚

## Redisçš„ä¼˜åŠ¿

- è¯»å†™æ€§èƒ½ä¼˜å¼‚
- ä¸°å¯Œçš„æ•°æ®ç±»å‹
- åŸå­æ€§
- ä¸°å¯Œçš„ç‰¹æ€§ï¼ˆå‘å¸ƒè®¢é˜…ã€é€šçŸ¥ã€è¿‡æœŸï¼‰
- æ”¯æŒæŒä¹…åŒ–ï¼ˆRDBå’ŒAOFæ–¹å¼æŒä¹…åŒ–ï¼‰
- åˆ†å¸ƒå¼

## Rediså¯ä»¥åšä»€ä¹ˆ

- æ•°æ®ç¼“å­˜
- é™æ—¶ä¸šåŠ¡
- è®¡æ•°å™¨ï¼ˆincrbyï¼‰
- åˆ†å¸ƒå¼é”ï¼ˆåŸºäºRedissonå®ç°åˆ†å¸ƒå¼é”ï¼‰
- é™æµï¼ˆä½¿ç”¨Redisä¸­çš„Listä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼‰
- æ¶ˆæ¯é˜Ÿåˆ—

# å®‰è£…/å¯åŠ¨

## å®‰è£…

[Centos8 å®‰è£…Redi:link:](https://www.beyondhorizon.top/article/OgSVnkzF)

## å¯åŠ¨

```bash
# åœ¨å‰å°å¯åŠ¨
redis-server
# åœ¨åå°å¯åŠ¨
brew services start redis
# å…³é—­
brew services stop redis
```

## è¿æ¥

```bash
redis-cli
```

>é»˜è®¤6379ç«¯å£
>
>redisé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“ï¼Œ0-15
>
>ä½¿ç”¨`select 1`æ¥åˆ‡æ¢

# åŸºç¡€å‘½ä»¤

- `keys *`æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æœ‰å“ªäº›keyï¼ˆæœ‰16ä¸ªæ•°æ®åº“ï¼‰
- `exists key`åˆ¤æ–­è¿™ä¸ªkeyæ˜¯å¦å­˜åœ¨
- `type key`æŸ¥çœ‹è¿™ä¸ªkeyçš„ç±»å‹
- `del key`æˆ–`unlink key`åˆ é™¤æŸä¸ªkey
    - `unlink`å¼‚æ­¥åˆ é™¤
- `expire key 10`è®¾ç½®keyè¿‡æœŸæ—¶é—´ ç§’
- `ttl key`æŸ¥çœ‹keyå¤šå°‘ç§’è¿‡æœŸ -1æ°¸ä¸è¿‡æœŸ -2å·²ç»è¿‡æœŸ
- `select`åˆ‡æ¢æ•°æ®åº“
- `dbsize`æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­keyæ•°é‡
- `flushdb`æ¸…é™¤å½“å‰æ•°æ®åº“æ‰€æœ‰key

# åŸºç¡€ç±»å‹ï¼ˆ5ç§ï¼‰

## stringï¼ˆå­—ç¬¦ä¸²ï¼‰

> - stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®
> - stringæ˜¯redisçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªvalueæœ€å¤§512Mb

### å‘½ä»¤

- `set <key> <value>`
- `get <key>`æŸ¥çœ‹
- `append <key> <value>`åœ¨keyåè¿½åŠ value
    - å¦‚æœè¿™ä¸ªkeyä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»º
- `strlen <key>`è·å–è¿™ä¸ªkeyå¯¹åº”valueé•¿åº¦
- `setnx <key> <value>`åªæœ‰å½“keyä¸å­˜åœ¨æ˜¯åˆ›å»º
- `incr <key>`è¿™ä¸ªkeyçš„value+1
- `decr <key>`value-1
- `incrby/decrby <key> <num>`keyçš„valueåŠ numæˆ–è€…å‡num

è¿™äº›æ“ä½œæ˜¯åŸå­æ€§æ“ä½œï¼Œåœ¨æ‰§è¡Œæ“ä½œæœŸé—´ä¸ä¼šåˆ«åˆ«çš„çº¿ç¨‹æ‰“æ–­ï¼Œå› ä¸ºredisæ˜¯å•çº¿ç¨‹

- `mset <key> <value> <key> <value> <key> <value>`ä¸€æ¬¡è®¾ç½®å¤šä¸ªky
- `mget <key> <key> <key>`ä¸€æ¬¡è·å–å¤šä¸ªkey
- `msetnx <key> <value> <key> <value>`ä¸€æ¬¡è®¾ç½®å¤šä¸ª å½“keyä¸å­˜åœ¨æ—¶å€™
    - åŸå­æ€§æ“ä½œ ä¸€ä¸ªå¤±è´¥å…¨éƒ¨å¤±è´¥
- `getrange <key> <å¼€å§‹> <ç»“æŸ>`è·å–keyä¸­ç¬¬<å¼€å§‹><ç»“æŸ>ä¸­é—´çš„æ‰€æœ‰value
- `setrange <key> <offset> <value>`åœ¨keyä¸­ç¬¬offsetä¹‹åè¦†ç›–è®¾ç½®value
- `setex <key> <è¿‡æœŸæ—¶é—´> <value>`åœ¨è®¾ç½®keyæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´
- `get set <key> <value>`å–ä¹‹å‰çš„ï¼Œå–å®Œä¹‹åå†è®¾ç½®æ–°çš„

### æ•°æ®ç»“æ„

Arraylist

### ä½¿ç”¨åœºæ™¯

1. ç¼“å­˜ï¼šä½¿ç”¨Redisä½œä¸ºMySQLç¼“å­˜ï¼Œé™ä½MySQLè¯»å†™å‹åŠ›
2. è®¡æ•°å™¨ï¼šRedisæ˜¯å•çº¿ç¨‹çš„ä¼˜åŠ¿
3. sessionï¼šspring session + rediså®ç°sessionå…±äº«

## listï¼ˆåˆ—è¡¨ï¼‰

> å•é”®å¤šå€¼ï¼Œåº•å±‚åŒå‘é“¾è¡¨

### å‘½ä»¤

- `lpush/rpush <key> <v1> <v2> <v3>`ä»åŒå‘é“¾è¡¨å·¦å³ä¸¤è¾¹pushå€¼
- `Large <key> 0 -1`ç¼–åˆ—é“¾è¡¨ï¼Œè·å–æ‰€æœ‰
- `rpop/lpop <key>`ä»å·¦å³è·å–å¹¶åˆ é™¤å€¼
- `rpoplpush <k1> <k2>`ä»k1å³è¾¹popä¸€ä¸ªå€¼ï¼Œåœ¨pushåˆ°k2å·¦è¾¹
- `lindex <key> idnex`è·å–ç¬¬indexä¸ªå€¼
- `llen <k>`è·å–é•¿åº¦
- `linsert before/after <v1> <v2>`åœ¨v1å‰/åæ’å…¥v2
- `lrem <key> <n> <v>`ä»åšç™¾å¹´åˆ é™¤nä¸ªvalue
- `lset <k> <idnex> <v>`å°†indexè®¾ç½®æˆv

### æ•°æ®ç»“æ„

å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹æ˜¯ziplistï¼Œå…ƒç´ å¤šäº†ä¹‹åä¼šå°†å¤šä¸ªziplistç»„æˆä¸€ä¸ªquicklist

### ä½¿ç”¨åœºæ™¯

1. æ¶ˆæ¯é˜Ÿåˆ—

## setï¼ˆé›†åˆï¼‰

> seté›†åˆä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œåº•å±‚hashè¡¨ï¼Œå¢åˆ æ”¹æŸ¥éƒ½æ˜¯O(1)å¤æ‚åº¦

### å‘½ä»¤

- `sadd <k> <v1> <v2>`æ·»åŠ 
- `smamber <k>`å–å‡ºè¯¥é›†åˆä¸­æ‰€æœ‰å€¼
- `sismamber <k> <v>`åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªvalue
- `scard <k>`è¿”å›è¿™ä¸ªé›†åˆé•¿åº¦
- `srem <k> <v> <v>`åˆ é™¤
- `spop <k>`éšæœºå–å‡ºå¹¶åˆ é™¤ä¸€ä¸ª
- `srandmameber <k> <n>`éšæœºå–å‡ºnä¸ªï¼Œä¸åˆ é™¤
- `smove <k1> <k2> <v>`æŠŠk1ä¸­çš„valueå–å‡ºæ¥ï¼Œæ”¾åˆ°k2ä¸­
- `sinter <k1> <k2>`è¿”å› äº¤é›†
- `sunion <k1> <k2>` è¿”å› å¹¶é›†
- `sdiff <k1> <k2>`è¿”å›å·®é›†

### ä½¿ç”¨åœºæ™¯

1. ç‚¹èµã€è½¬å‘ã€æ”¶è—ç­‰

## hashï¼ˆæ•£åˆ—ï¼‰

> ç±»ä¼¼äºjavaä¸­çš„map<string,object>ï¼Œkeyæ˜¯å¯¹è±¡åï¼Œvalueé‡Œè¾¹æ˜¯fildå’Œvalue

### å‘½ä»¤

- `hset <k> <field> <value>`è®¾ç½®key å’Œkeyä¸­çš„fieldå’Œvalue
- `hget <k> <field>` è·å–kä¸­fieldä¸­çš„value
- `hmset <k> <field1> <v1> <field2> <v2>`ä¸€æ¬¡è®¾ç½®å¤šä¸ª
- `hexists <k1> <field>`æŸ¥çœ‹keyä¸­çš„filedæ˜¯å¦å­˜åœ¨
- `hkeys <key>`è·å–è¯¥keyçš„æ‰€æœ‰field
- `havals <key>`è·å–è¯¥keyçš„æ‰€æœ‰vlaueï¼Œæ²¡æœ‰field
- `hincrby <k> <f> <n>`ç»™fçš„valueåŠ n
- `hsetnx <k> <f> <v>`filedä¸å­˜åœ¨åˆ™è®¾ç½®value

### æ•°æ®ç»“æ„

å½“field-valueé•¿åº¦çŸ­ä¸”ä¸ªæ•°å°‘æ—¶ä½¿ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hashtable

### ä½¿ç”¨åœºæ™¯

1. ç¼“å­˜

## Zsetï¼ˆæœ‰åºé›†åˆï¼‰

> æœ‰åºé›†åˆ
>
> æ¯ä¸ªå…ƒç´ éƒ½æœ‰è¯„åˆ†ï¼ˆscoreï¼‰ï¼Œä½¿ç”¨è¿™ä¸ªscoreæ¥ç»™é›†åˆæ’åºï¼Œscoreå¯ä»¥é‡å¤
>
> åŠ æƒæ’åºsetï¼Œç±»ä¼¼äºJavaä¸­ä¼˜å…ˆé˜Ÿåˆ—ï¼Œåªä¸è¿‡redisä¸­å°†é˜Ÿåˆ—æ›´æ¢ä¸ºset

### å‘½ä»¤

- `zadd <k> <score> <k> <score> <k> <score>`æ·»åŠ keyå’Œscoreï¼Œä¼šæ ¹æ®scoreæ’å
- `arange <k> <start> <stop> withscores`è·å–scoresåœ¨å¼€å§‹å’Œç»“æŸä¹‹é—´çš„å…ƒç´ 
- `zrangebyscore <k> <mim> <max>`è¿”å›å¹¶ä¸”æ’å æœ€å°scoreså’Œæœ€å¤§scores
- `zincrbg <k> <n> <v>`ä¸ºå…ƒç´ væ·»åŠ nçš„scores
- `zrem <k> <v>`åˆ é™¤
- `zcount <k> <min> <max>`ç»Ÿè®¡min scores å’Œmax scoresä¹‹é—´å…ƒç´ ä¸ªæ•°
- `zrank <k> <v>`è·å–è¯¥å…ƒç´ çš„æ’åï¼Œä»0å¼€å§‹

### æ•°æ®ç»“æ„

hash è·³è·ƒè¡¨

### ä½¿ç”¨åœºæ™¯

1. æ’è¡Œæ¦œ

# ç‰¹æ®Šç±»å‹ï¼ˆ3ç§ï¼‰

> ä»¥ä¸‹å†…å®¹çš„å­¦ä¹ å‡æ¥è‡ªäºæ­¤ï¼Œä½¿ç”¨äº†ä»£ç ç‰‡æ®µ
>
> [åŸæ–‡åœ°å€:link:](https://www.pdai.tech/md/db/nosql-redis/db-redis-data-type-special.html#hyperloglogs%E5%9F%BA%E6%95%B0%E7%BB%9F%E8%AE%A1)

## HyperLogLogsï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰

### ä»€ä¹ˆæ˜¯åŸºæ•°

ä¸¤ä¸ªé›†åˆçš„å…¨é›†

ä¾‹å¦‚ï¼šA = {1,2,3,4,5,6} ; B = {5,6,7,8,9} ; åŸºæ•° = {1,2,3,4,7,8,9} ï¼Œå³ä¸é‡å¤å…ƒç´ ã€‚

### ä½¿ç”¨åœºæ™¯

ç»Ÿè®¡å’Œè®¡æ•°ï¼Œç”¨äºç»Ÿè®¡æ³¨å†ŒIPæ•°ï¼Œæ¯æ—¥è®¿é—®IPä¹¦ï¼Œé¡µé¢å®æ—¶UVï¼Œåœ¨çº¿ç”¨æˆ·æ•°ç­‰ã€‚

### ä¼˜åŠ¿

åŸºäºåŸºæ•°ä¼°ç®—çš„ç®—æ³•ï¼Œèƒ½æ¯”è¾ƒå‡†ç¡®çš„ä¼°ç®—å‡ºåŸºæ•°ï¼Œå¯ä»¥ä½¿ç”¨å°‘é‡å›ºå®šçš„å†…å­˜å­˜å‚¨å¹¶è¯†åˆ«é›†åˆä¸­å”¯ä¸€çš„åŸè‰²ã€‚

è¿™ä¸ªç®—æ³•å¹¶ä¸ä¸€å®šå‡†ç¡®ï¼Œæœ‰0.81%çš„é”™è¯¯ç‡ï¼ŒåŸºæ•°ç»Ÿè®¡é€‚åˆæ¥å—ä¸€å®šå®¹é”™çš„åœºæ™¯ï¼Œæ¯”å¦‚ç»Ÿè®¡è®¿å®¢æ•°é‡ç­‰ã€‚

### å‘½ä»¤

```sh
127.0.0.1:6379> pfadd key1 a b c d e f g h i	# åˆ›å»ºç¬¬ä¸€ç»„å…ƒç´ 
(integer) 1
127.0.0.1:6379> pfcount key1					# ç»Ÿè®¡å…ƒç´ çš„åŸºæ•°æ•°é‡
(integer) 9
127.0.0.1:6379> pfadd key2 c j k l m e g a		# åˆ›å»ºç¬¬äºŒç»„å…ƒç´ 
(integer) 1
127.0.0.1:6379> pfcount key2
(integer) 8
127.0.0.1:6379> pfmerge key3 key1 key2			# åˆå¹¶ä¸¤ç»„ï¼škey1 key2 -> key3 å¹¶é›†
OK
127.0.0.1:6379> pfcount key3
(integer) 13
```

## Bitmapï¼ˆä½å­˜å‚¨ï¼‰

Bitmapæ˜¯é€šè¿‡äºŒè¿›åˆ¶è®°å½•ä¿¡æ¯ï¼Œåªæœ‰ 0 å’Œ 1 ä¸¤ä¸ªçŠ¶æ€

### ä½¿ç”¨åœºæ™¯

1. ç»Ÿè®¡ç”¨æˆ·ç™»é™†ä¿¡æ¯ï¼Œç™»é™†å’Œæœªç™»é™†
2. ç»Ÿè®¡ç”¨æˆ·ç‚¹èµä¿¡æ¯ï¼Œç‚¹äº†å’Œæ²¡ç‚¹
3. ç»Ÿè®¡å‘˜å·¥æ‰“å¡ä¿¡æ¯ï¼Œæ‰“äº†å’Œæ²¡æ‰“

### å‘½ä»¤

- ä½¿ç”¨`setbit <key> <offset> <value>`å†™å…¥æ•°æ®ï¼Œå…¶ä¸­keyå¯ä»¥ä»»æ„ï¼Œoffsetåªèƒ½ä¸ºIntegerï¼Œvalueåªèƒ½ä¸º0æˆ–1

    å¦‚æœè¦ç»Ÿè®¡å‘˜å·¥ä¸€å‘¨çš„æ‰“å¡æƒ…å†µï¼Œkeyå¯ä»¥è®¾ç½®ä¸ºsignï¼Œoffsetè®¾ç½®ä¸º0-6ï¼Œæ‰“å¡ä¸º0ï¼Œæœªæ‰“å¡ä¸º1

```sh
127.0.0.1:6379> setbit sign 0 1
(integer) 0
127.0.0.1:6379> setbit sign 1 1
(integer) 0
127.0.0.1:6379> setbit sign 2 0
(integer) 0
127.0.0.1:6379> setbit sign 3 1
(integer) 0
127.0.0.1:6379> setbit sign 4 0
(integer) 0
127.0.0.1:6379> setbit sign 5 0
(integer) 0
127.0.0.1:6379> setbit sign 6 1
(integer) 0
```

- ä½¿ç”¨`getbit <key> <offset>`æ¥æŸ¥çœ‹æŸä¸€ä¸ªkeyçš„çŠ¶æ€ï¼Œè¿”å›0æˆ–1

```sh
127.0.0.1:6379> getbit sign 3
(integer) 1
127.0.0.1:6379> getbit sign 5
(integer) 0
```

- ä½¿ç”¨`bitcount <key>`ç»Ÿè®¡æŸä¸€é¡¹æ•°æ®çš„æ€»æ•°

```sh
127.0.0.1:6379> bitcount sign
(integer) 3
```

## geospatialï¼ˆåœ°ç†ä½ç½®ï¼‰

å¯ä»¥ç”¨æˆ·æ¨ç®—åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¦‚ä¸¤åœ°ä¹‹é—´è·ç¦»ç­‰

### å‘½ä»¤

- `geoadd`æ·»åŠ ä½ç½®

```sh
127.0.0.1:6379> geoadd china:city 118.76 32.04 nanjing 112.55 37.86 taiyuan 123.43 41.80 shenyang
(integer) 3
127.0.0.1:6379> geoadd china:city 144.05 22.52 shengzhen 120.16 30.24 hangzhou 108.96 34.26 xian
(integer) 3
```

- `geopop`è·å–æŒ‡å®šæˆå‘˜çš„åœ°ç†ä½ç½®

```sh
127.0.0.1:6379> geopos china:city taiyuan nanjing
1) 1) "112.54999905824661255"
   1) "37.86000073876942196"
2) 1) "118.75999957323074341"
   1) "32.03999960287850968"
```

- `geodist`è·å–ä¸¤åœ°ä¹‹é—´çš„è·ç¦»ï¼Œå¯ä»¥æŒ‡å®šå•ä½

```sh
127.0.0.1:6379> geodist china:city taiyuan shenyang m
"1026439.1070"
127.0.0.1:6379> geodist china:city taiyuan shenyang km
"1026.4391"
```

- `georadius`

[è¿™é‡Œæœ‰è¯¦ç»†è§£é‡Š:link:](https://cloud.tencent.com/developer/section/1374022)

é™„è¿‘çš„äººï¼Œè·å¾—æ‰€æœ‰é™„è¿‘çš„äººçš„åœ°å€, å®šä½, é€šè¿‡åŠå¾„æ¥æŸ¥è¯¢

- `georadiusbymember`

[link:link:](https://cloud.tencent.com/developer/section/1374023)

æ˜¾ç¤ºä¸æŒ‡å®šæˆå‘˜ä¸€å®šåŠå¾„èŒƒå›´å†…çš„å…¶ä»–æˆå‘˜