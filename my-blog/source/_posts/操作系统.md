---
title: 操作系统
date: 2022/8/30 17:33:50
updated: 2023/3/23 22:57:36
categories:
- Others
tags:
- OS
---

# C1

> **OS的定义**：
>
> OS是管理计算机**硬件**和**软件**资源、**合理调度作业**运行，**方便用户**使用的**程序集合**。

## OS的目标和作用

### 目标

1. 有效性
2. 方便性
3. 可扩充性
4. 开放性

### 作用

1. OS 作为用户与计算机硬件系统之间的接口

    ![image-20220830164320758](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220830164320758-20220830164356192.png)

2. OS 作为计算机系统资源的管理者

3. OS 作为计算机功能扩充机

4. OS 实现了对计算机资源的抽象

## OS发展的动力

1. 不断提高计算机资源利用率
2. 方便用户
3. 硬件的不断更新换代
4. 计算机体系结构的不断发展
5. 不断提出新的应用需求

## OS发展过程

### 无OS的计算机

1. 人工OS
2. 脱机输入输出方式

### 单道批处理系统

#### 过程

1. 将一批作业（程序）以脱机方式输入磁盘
2. 监督程序将磁盘上第一个作业装入内存，并将运行控制权交给该作业
3. 一个作业处理完成后将控制权还给监督程序

#### 特征

- 自动性
- 顺序性
- 单道性

#### 缺点

系统资源得不到充分利用

### 多道批处理系统

#### 过程

IO空闲期间读入其他作业

#### 特征

1. 多道性
2. 调度性
3. 无序性

#### 技术指标

**周转时间**：指作业从提交到完成所用的时间

#### 缺点

1. 资源利用率高
2. 系统吞吐量大
3. 平均周转时间长
4. 无交互能力

#### 解决的问题

1. 处理机管理问题
2. 内存管理问题
3. IO设备问题
4. 文件管理问题
5. 作业管理问题
6. 用户于系统接口问题

### 分时系统

> 分时系统：值在一台主机上，连接了多个带有显示器和键盘的终端，同时允许多个用户通过自己的终端，使用计算机，共享主机中的资源

#### 关键问题

1. 及时接收
2. 及时处理

#### 关键技术

1. 多路卡
2. 时间片轮转技术

> 把计算机系统资源（CPU时间）进行时间上的分割，每个时间短称为一个时间片q，每个用户轮流使用时间片

#### 技术指标

- 响应时间，从用户向系统化发出请求，到系统响应为止的时间

### 实时系统

系统能够即时响应外部事件的请求，在规定时间内完成对该事件的处理，并控制所有是时系统协调一致地运行

#### 种类

1. 工业（武器）控制系统
2. 信息查询系统
3. 多媒体系统
4. 嵌入式系统

#### 类型

1. 周期性和非周期性实时任务
2. 硬实时任务和软实时任务（截止时间是否严格要求）

#### 技术指标

**截止时间**

1. 开始截止时间：任务在某时间必须开始执行
2. 完成截止时间：任务在某时间必须完成

# C2

> Q：简述OS的发展历程

> 1. 未配置OS的计算机系统
>     1. 人工操作方式，**特征**：用户独占全机，CPU等待人工操作的时间被浪费
>     2. 脱机I/O方式，**特征**：输入输出过程独立，节省IO时间造成时间浪费
> 2. 单道批处理系统
>     1. 系统中资源得不到充分利用
> 3. 多道批处理系统
>     1. 作业放在外存，多个作业一次放入内存，有调度程序控制
>     2. 技术指标周转时间
>     3. 资源利用率高，系统吞吐量大
> 4. 分时系统

## 微机OS的发展

### 单用户单任务OS

1. CP/M
2. MS-DOS

### 单用户多任务OS

一个用户，一台主机，程序分成多个任务，并发执行

### 多用户多任务OS

1. UNIX OS

## OS的基本特性

1. 并发

    > **并行和并发的区别**：
    >
    > **并行**：两个或多个时间在同一时刻发生
    >
    > **并发**：两个或多个时间在同一时间间隔内发生

2. 共享

    > **共享指系统中资源可供多个执行的进程共同使用**
    >
    > **互斥共享方式**：有些设备在一段时间内只允许一个进程访问，例如打印机
    >
    > **同时访问方式**：允许一段时间内有多个进程同时进行访问，例如内存

3. 虚拟

    > 使用各种技术实现对硬件的扩充

4. 异步

> 因为进程并发执行，导致调度过程中，执行顺序，完成时间都不确定，结果不可预知，称为异步性。

## OS的功能

- 处理机管理功能
- 存储器管理功能
- 设备管理功能
- 文件管理功能
- 操作系统与用户之间的接口

# C3

> 进程的描述与控制

### 前趋图

是一个有向无循环图，描述进程之间执行的先后顺序

### 程序的执行

#### 顺序执行

特征：

- 顺序性
- 封闭性，程序运行时，独占全机资源
- 可再现性

#### 并发执行

同一时间间隔内，同时执行

特征：

- 间断性
- 失去封闭性
- 不可再现性

## 进程

> 进程使程序并发执行，并且可以对并发执行的程序加以描述和控制

### 定义

1. 进程是程序的一次执行
2. 进程是一个程序及其数据在处理机上顺序执行时所发生的活动
3. 进程是具有独立功能的程序在一个数据集合上运行的进程，它是系统进行资源分配和调度的一个独立单位

### 基本状态

1. 就绪状态：当前进程已经具备运行条件
2. 执行状态：占有CPU正在运行
3. 阻塞状态
4. 创建状态
5. 终止状态

### 状态之间的转换

![image-20220906162417087](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220906162417087.png)

# C4

## 进程管理中的数据结构（PCB）

> 用于管理控制进程各个状态的转换

### PCB的作用

1. 作为独立运行基本单位的标志
2. 能实现间断性运行方式
3. 提供进程管理所需要的信息
4. 提供进程调度所需要的信息
5. 实现与其他进程的同步与通信

### PCB中的信息

1. 进程标识信息
2. 处理机状态
3. 进程调度信息
4. 进程控制信息

![image-20220906165251658](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220906165251658.png)

![image-20220906175109022](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220906175109022.png)

### 进程控制块的组织方式

- 链接方式
- 索引方式

### 进程实现的队列模型

> 进程在其生命周期中，被组织成若干个队列进行管理

1. 队列管理模块是OS实现进程管理的核心模型
2. OS简历多个进程队列，包括就绪队列和等待队列
3. OS将上述队列按需组成普通队列，或优先队列
4. 队列中的进程可通过PCB中队列指引元，采用单/双指引元或索引连接
5. 进程的管理与资源调度围绕进程队列的出/入操作全面展开

## 进程控制

> 进程控制一般是OS的内核中的原语来实现的

### 进程的创建

> 允许一个进程创建另一个进程

1. 申请空白PCB，为新进程申请获得唯一数字标识符，并从PCB集合中索取一个空白PCB
2. 为新进程分配时期允许所需的资源，包括各种物理和逻辑资源，入内存，文件，IO设备和CPU时间
3. 初始化进程控制快PCB
4. 如果进程就绪队列能够接纳新进程，便使新进程插入就绪队列

### 进程的终止

#### 终止的原因

1. 正常结束
2. 异常结束
3. 外界干预，kill指令等等

#### 终止的过程

1. 根据被终止进程标识符PID，从PCB集合中检索出该进程的PCB，崇中读取出该进程的状态
2. 若被终止的进程正处于执行状态，应该立即终止该进程的执行，并置调度标志为真，用于只是该进程被终止后应该重新进行调度
3. 若该进程还有子进程，需将所有子进程一并终止
4. 将被终止进程所拥有的全部资源或者归还给父进程，或者归还给系统
5. 将被终止进程的PCB从其所在队列一处，等待其他程序来收集信息

### 进程的阻塞与唤醒

#### 以下操作会引起进程阻塞或被唤醒

1. 向系统请求共享资源失败
2. 等待某种操作的完成
3. 新数据尚未到达
4. 等待新任务的到达

#### 进程阻塞的过程

![image-20220906174826519](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220906174826519.png)

#### 唤醒的过程

![image-20220906174842600](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220906174842600.png)

### 挂起与激活

#### 挂起

修改进程状态，移出相关队列，收回内存等资源，将进程送至对换区（磁盘缓冲区）

#### 激活过程

分配内存，修改进程状态，移入相关队列

# C5

# C6

## 进程同步

> 进程同步的概念：多道程序环境中，并发进程之间存在资源共享，进程间存在制约关系

### 两种形式的制约关系

1. 间接相互制约关系，进程互斥
2. 直接相互制约关系，进程同步

### 临界资源

> 在一段时间内只能被一个进程使用的资源，即互斥共享变量所代表的资源

### 临界区

> 每个进程中访问临界资源的代码称为临界区

### 同步机制应遵循的规则

1. 空闲进入
2. 忙则等待
3. 有限等待
4. 让权等待

# C7

## 信号量机制

### 整形信号量

用于表示资源数目的整形S，

除初始化外，仅能通过两个标准的原子操作Wait（S）和Signal（S）来访问。其通常分别被称为P、V操作。

**描述如下：**

> P操作：S=S-1；如果S小于0，则进程进入等待状态无限循环，否则继续执行。
>
> V操作：S=S+1；如果S>=0，则唤醒等待队列中的一个等待进程。

![image-20220917150323593](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220917150323593.png)

```
enLock(S){// 进入区加锁，进行资源检查，如果未被进入，允许进入。
 while(s<=0); //do no-op
   s--;
}

临界区（Critical section）//一般进行资源的写操作（例如对静态变量，或者成员变量的修改）


deLock(s){
   s++;//退出区，将临界区正被访问的标志恢复为原来的标志。
}

otherCode //剩余区
```

**缺点：**整型信号量违反了同步机制的“让权等待”原则，使程序处于忙等状态。

### 记录型信号量

用一个数记录所有资源的数量。

![image-20220917150257822](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220917150257822.png)

```java
public class TestThreadSynchronized2 {
    public static void main(String[] args) {
        Toilet2 toilet=new Toilet2(); 
        int allPersonNumber=20;//定义一起上厕所的人数
        for (int i=0;i<allPersonNumber;i++){
            new Thread(toilet).start();//开启20个线程任务同时访问五个厕所
        }
    }
}

public class Toilet2 implements Runnable{
    int value=5;//定义资源个数
    LinkedList linkedList=new LinkedList();//“让权等待”后的阻塞线程用链表进行串联起来
    @Override
    public void run() {
        value--;//当申请一个单位的该类资源时候，资源就会减少一个
        if (value<0){ //判断剩余资源是否小于零，如果小于零，进行下列代码(注意为啥小于零不包含在内，因为value--,当value=1时，后申请到一个资源后value=0，进入厕所权限已经申请到，直接上厕所不必等待 )
            try{
                this.wait();//阻塞自己
                linkedList.add(this);//把阻塞的线程添加到链表中，此时链表的长度就是阻塞线程个数
            }catch (InterruptedException e){
                e.printStackTrace();
            }
        }
        System.out.println(Thread.currentThread().getName()+"厕所位置一共有5个，剩余"+value+"个，请您耐心等待");
        value++;//Person上完厕所以后要归还资源，所以value++;
        if (value<=0){ //判断如果资源小于等于零的话，那么唤醒链表中第一个排队的person来上厕所
            linkedList.removeFirst().notify();
        }
    }
}
```

# C8

# C9

## 信号量机制（续）

### AND 型信号量

#### 基本思想

1. 将进程在整个运行过程中所需要的所有资源，一次性全部分配给进程，待进程使用完后再一起释放
2. 全部分配到进程或不分配

只有进程所需的资源全部满足是，才执行Si := Si - 1操作。只要发现有一个资源不满足，将进程阻塞在在第Si的队列中

### 信号量集

S 信号量，d 需求值，t 下限值

1. 如果Si >= ti 可分配。否则不分配
2. 每次分配di，用于信号量增减，Si = Si - di

只有进程所需要的资源全部满足Si > ti（大于下限值）时，执行Si := Si - 1。只要发现有第Si个资源不满足，将进程阻塞在Si



## 管程机制

### 定义

系统中的各种硬件资源和软件资源均可用数据结构抽象的描述其资源特性，即用少量信息和对该资源执行的操作来表示该资源，二忽略其内部结构和实现细节

类

![image-20220920171642137](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220920171642137.png)

![image-20220920171928955](https://typora-1308549476.cos.ap-nanjing.myqcloud.com/img/image-20220920171928955.png)

